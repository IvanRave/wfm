define(["ko","jquery","infuser"],function(n,t,i){var u=function(t,r){var u=this,f;u.templateId=t;u.loaded=!1;u.template=n.observable(i.defaults.useLoadingTemplate?i.defaults.loadingTemplate.content:undefined);u.template.data={};u.options=n.utils.extend({},r);u.options.templateId=t;u.options&&u.options.afterRender&&(f=u.options.afterRender,r.afterRender=function(){u.loaded&&f.apply(u.options,arguments)})},r;n.utils.extend(u.prototype,{data:function(n,t){if(arguments.length===1)return n==="precompiled"&&this.template(),this.template.data[n];this.template.data[n]=t},text:function(){if(this.loaded||this.getTemplate(),arguments.length===0)return this.template();this.template(arguments[0])},getTemplate:function(){var n=this;i.get(n.options,function(t){n.data("precompiled",null);n.template(t);n.loaded=!0})}});r=function(t){var i=t?new t:new n.nativeTemplateEngine;return i.templates={},i.makeTemplateSource=function(t,r,f){if(typeof t=="string"){var e=document.getElementById(t);return e?new n.templateSources.domElement(e):(i.templates[t]||(i.templates[t]=new u(t,f)),i.templates[t])}if(t.nodeType==1||t.nodeType==8)return new n.templateSources.anonymousTemplate(t)},i.renderTemplate=function(n,t,r){var u=i.makeTemplateSource(n,t,r);return i.renderTemplateSource(u,t,r)},i};n.KoExternalTemplateEngine=r;t.tmpl&&t.tmpl.tag.tmpl.open.toString().indexOf("__")>=0?n.setTemplateEngine(new r(n.jqueryTmplTemplateEngine)):n.setTemplateEngine(new r)});